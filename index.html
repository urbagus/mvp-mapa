<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MVP mapa</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
function lerp(a, b, t) {
  return a + (b - a) * t;
}

// rojo -> amarillo -> verde continuo
function getColor(v) {
  if (v == null) return "#ccc";

  const min = 0;
  const max = 9.5; // ajustable
  const t = Math.max(0, Math.min(1, (v - min) / (max - min)));

  // gradiente rojo -> verde pasando por amarillo
  const r = Math.round(lerp(220, 34, t));
  const g = Math.round(lerp(50, 139, t));
  const b = Math.round(lerp(47, 34, t));

  return `rgb(${r},${g},${b})`;
}

function style(feature) {
  const v = feature.properties.acc_index;
  return {
    weight: 0,
    fillOpacity: 0.85,
    fillColor: getColor(v)
  };
}

fetch("./data/hex_index_access.geojson")
  .then(r => r.json())
  .then(data => {
    const layer = L.geoJSON(data, { style }).addTo(map);
    map.fitBounds(layer.getBounds(), { padding: [20, 20] });
  });

  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const map = L.map("map").setView([-32.95, -60.66], 12);

    L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", {
      maxZoom: 20,
      attribution: "&copy; OpenStreetMap &copy; CARTO"
    }).addTo(map);

    fetch("./data/hex_index_access.geojson")
      .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status} al cargar el GeoJSON`);
        return r.json();
      })
      .then(data => {
        const layer = L.geoJSON(data, {
          style: { weight: 1, opacity: 0.8, fillOpacity: 0.35 }
        }).addTo(map);

        try { map.fitBounds(layer.getBounds(), { padding: [20, 20] }); } catch(e) {}
      })
      .catch(err => {
        console.error(err);
        alert("No pude cargar el GeoJSON. Mir√° la consola (F12). " + err.message);
      });
  </script>
</body>
</html>

